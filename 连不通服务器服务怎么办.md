title: 连不通服务器服务怎么办
tags: [issue,DevOps]
showLanguage: false
postLink: when-you-can-not-connect-to-your-server-service
date: 2016-03-31 22:46:59
index: 当你访问不到自己web服务器数据,当你ssh登陆被拒,当你pop3读取邮件失败...一句话,当你连不通你的服务器服务,你该怎么办?本文总结出通用而简单的步骤来指导你.
---
当你访问不到自己web服务器数据,当你ssh登陆被拒,当你pop3读取邮件失败...一句话,当你连不通你的服务器服务,你该怎么办?本文总结出通用而简单的步骤来指导你.
## 足够简单的思路
本地机器与远端服务器建立连接,消费服务的整个链路可显而易见划分为三部分,本机到网关部分,互联网部分,服务器网关到服务器部分.当然就大部分情况而言一般都是服务器部分的原因:出于安全问题的考虑,我们总会在服务器端进行访问限制,添加防火墙,设置security forbidden.好吧,无论问题的原因是什么,我们查找问题的步骤如下:
* 嗅探源:利用最简单的网络工具嗅探问题源为三部分的哪个
* 定位:找到源后查看相关防火墙及具体服务的status && access log

注意:问题源是指你连接服务数据包终止断掉的地方,而并不是指哪一方不合理导致的问题

---
## 来嗅探问题源吧

#### 先来ping一下
通过对启用了 ICMP 的网站运行 ping 命令来测试是否可以连接到 Internet
ping是一款基于ICMP的网络测试工具,用来测试本机到测试机的网络连通性,这是一个最基本的工具,几乎人人都会用,但是要知道,我们一般用此基本命令来确认要ping的主机是否启动并对两点间的网络连通行有一个模糊而大概的掌握,因为当你能ping通时可以证明远程主机处于开机状态且网络通畅,但ping不通时却不能成为网络不通畅或
远程机未开的证据,因为这有可能是服务器禁止来自internet的ping包或在某路由处被丢弃(ping包的处理优先级较低).命令行命令为:** ping ip (domain name) **
* ping通:不能确定问题源,但问题将集中于权限,端口被禁或端口,密码错误等
* ping不通:暂不能确定问题源

虽然经历完此步后并不能完全确定问题源,但若加之你平时对这条连接线的熟悉程度及使用率,你可能已经知道问题所在了对吗?这也是大部分人止于ping的原因.

#### telnet测试服务端口是否开放
如果已经ping通服务器,那我们用telnet来测试一下服务具体端口是否可用,若失败则问题源在服务器部分.如果ping失败,且telnet具体端口失败,则优先认为本机到网关部分为问题源.可对本机所在局域网的NAT进行telnet端口测试,若失败则问题源确定在本机及本地网络部分.
命令为:** telnet address port **

#### traceroute观察包流动
当经过上面两个工具都未能确定问题源时你可能需要亲眼来观察一下数据包流动情况了,traceroute可以列出你访问某一服务器的数据包传递的路由状况,timeout时显示＊＊＊.可以通过该命令查看数据包是否通过本地网关及整个传递过程的信息.命令为:** telnet address **

---

## 来定位具体问题

#### 查看服务log
当你定位问题源是服务器一端时你就可以登上服务器查看相关服务的log.比如说,如果你请求的是万维网服务器,你可以查看/tmp/log/apache/error.log 或者 /tmp/log/apache/access.log

---

## 最后说两句

上面的理论是平日里实践的积累,然后以一个自认为能让大家好理解好应用的脉络整理出来,其实自己也未必是按这个流程走的,毕竟"大千世界,千变万化,每个人都要负责交自己的答卷,何必那么死板",哈哈哈,分享鸡汤总有点想笑...不过,去做一名ops或dev-ops,对分析问题时获得的信息敏感度很重要,拿到问题时心中能有百种怀疑只待一一验证这应该是最让人踏实的事情了.